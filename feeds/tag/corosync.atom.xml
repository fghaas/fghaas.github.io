<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>xahteiwi.eu - Corosync</title><link href="https://fghaas.github.io/" rel="alternate"></link><link href="https://fghaas.github.io/feeds/tag/corosync.atom.xml" rel="self"></link><id>https://fghaas.github.io/</id><updated>2012-03-15T09:11:34+01:00</updated><entry><title>What's a Totem "Retransmit List" all about in Corosync?</title><link href="https://fghaas.github.io/resources/hints-and-kinks/whats-totem-retransmit-list-all-about-corosync/" rel="alternate"></link><published>2012-03-15T09:11:34+01:00</published><updated>2012-03-15T09:11:34+01:00</updated><author><name>Florian Haas</name></author><id>tag:fghaas.github.io,2012-03-15:/resources/hints-and-kinks/whats-totem-retransmit-list-all-about-corosync/</id><summary type="html">&lt;p&gt;Occasionally, you may see errors similar to this in your system logs:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;corosync [TOTEM ] Retransmit List: e4 e5 e7 e8 ea eb ed ee
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here's what causes them, and what you can do to fix the issue.&lt;/p&gt;
&lt;p&gt;Corosync, more specifically its Totem protocol implementation, defines
a maximum number of cluster …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Occasionally, you may see errors similar to this in your system logs:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;corosync [TOTEM ] Retransmit List: e4 e5 e7 e8 ea eb ed ee
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here's what causes them, and what you can do to fix the issue.&lt;/p&gt;
&lt;p&gt;Corosync, more specifically its Totem protocol implementation, defines
a maximum number of cluster messages that can be sent during one token
rotation. By default, that number is 50, but you may modify this value
by setting the &lt;code&gt;window_size&lt;/code&gt; parameter in your &lt;code&gt;corosync.conf&lt;/code&gt;
configuration file.&lt;/p&gt;
&lt;p&gt;When among several fast cluster nodes ("processors" in Totem speak)
there are one or few slow ones, the kernel receive buffers can't cope,
messages get lost, and they then need to be retransmitted. This is
what causes the Retransmit List notifications in the syslogs. This
doesn't mean you're losing any messages or data. But it does mean that
your cluster performance degrades when this happens, and thus you
should really fix that problem.&lt;/p&gt;
&lt;p&gt;There are a few considerations that apply to tuning Corosync's
&lt;code&gt;window_size&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;If you have a small cluster (say, 8 nodes or less), and they all can
  be expected to perform equally well because they have identical or
  nearly-identical hardware, then setting a large &lt;code&gt;window_size&lt;/code&gt; of up
  to 300 should be fine.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;If your cluster is rather heterogeneous, then you should probably
  stick with the default of 50. Definitely don't go higher than
  256000/MTU, where MTU is that of the network interface(s) Corosync
  communicates over. For a standard Ethernet interface the default MTU
  is 1500, which would make for a maximum &lt;code&gt;window_size&lt;/code&gt; of 170.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;If you're running on the generally safe default of 50, and you're
  still getting Retransmit List notifications, then one of your nodes
  is most likely significantly slower than the others, and you had
  better find the cause of that and fix it. The node could be under
  constant excessive load, or have a problem with its network driver,
  or may be plugged into an incorrectly-configured switch port.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr/&gt;
&lt;p&gt;This article originally appeared on the &lt;code&gt;hastexo.com&lt;/code&gt; website (now defunct).&lt;/p&gt;</content><category term="hints-and-kinks"></category><category term="Corosync"></category></entry><entry><title>Checking Corosync cluster membership</title><link href="https://fghaas.github.io/resources/hints-and-kinks/checking-corosync-cluster-membership/" rel="alternate"></link><published>2012-03-04T23:42:35+01:00</published><updated>2012-03-04T23:42:35+01:00</updated><author><name>Florian Haas</name></author><id>tag:fghaas.github.io,2012-03-04:/resources/hints-and-kinks/checking-corosync-cluster-membership/</id><summary type="html">&lt;p&gt;It's simple and easy to get Pacemaker's view of the status of members
in a cluster – just invoke &lt;code&gt;crm_mon&lt;/code&gt;. But what if you want to check on
the cluster membership when Pacemaker is not running, or you want to
make sure whether Corosync's view of the cluster is identical to …&lt;/p&gt;</summary><content type="html">&lt;p&gt;It's simple and easy to get Pacemaker's view of the status of members
in a cluster – just invoke &lt;code&gt;crm_mon&lt;/code&gt;. But what if you want to check on
the cluster membership when Pacemaker is not running, or you want to
make sure whether Corosync's view of the cluster is identical to
Pacemaker's? Here's how.&lt;/p&gt;
&lt;h2&gt;Checking ring status with &lt;code&gt;corosync-cfgtool&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;corosync-cfgtool&lt;/code&gt; utility displays the cluster connectivity status
when invoked with the &lt;code&gt;-s&lt;/code&gt; flag:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# corosync-cfgtool -s&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;Printing&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ring&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;Local&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ID&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;303938909&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;RING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ID&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;10.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;1.1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ring&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;active&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;with&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;no&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;faults&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;RING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ID&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mf"&gt;42.1&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ring&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;active&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;with&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;no&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;faults&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The above is the status of two healthy rings; a failed ring (one
affected by a network interruption, for example) would show a &lt;code&gt;FAULTY&lt;/code&gt;
status.&lt;/p&gt;
&lt;p&gt;There's a catch. In a two-node cluster, if both nodes were to start
while all cluster communication links are down, then Corosync would
form &lt;em&gt;two&lt;/em&gt; memberships with healthy, one-member rings. Both of the
nodes would show a ring status similar to the above, but your cluster
still wouldn't be communicating. So, you can't rely on
&lt;code&gt;corosync-cfgtool -s&lt;/code&gt; alone. You must also check Corosync's member
list.&lt;/p&gt;
&lt;h2&gt;Querying the member list with &lt;code&gt;corosync-cmapctl&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;We can examine Corosync's cluster member list with the &lt;code&gt;corosync-cmapctl&lt;/code&gt; command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# corosync-cmapctl | grep member
runtime.totem.pg.mrp.srp.members.303938909.ip=r(0) ip(10.0.1.1) r(1) ip(192.168.42.1) 
runtime.totem.pg.mrp.srp.members.303938909.join_count=1
runtime.totem.pg.mrp.srp.members.303938909.status=joined
runtime.totem.pg.mrp.srp.members.320716125.ip=r(0) ip(10.0.1.2) r(1) ip(192.168.42.2) 
runtime.totem.pg.mrp.srp.members.320716125.join_count=1
runtime.totem.pg.mrp.srp.members.320716125.status=joined
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In this example, we have two nodes (with node IDs &lt;code&gt;303938909&lt;/code&gt; and
&lt;code&gt;320716125&lt;/code&gt;). They are both configured to use two communication rings,
&lt;code&gt;r(0)&lt;/code&gt; and &lt;code&gt;r(1)&lt;/code&gt;, and both of them have successfully joined the
cluster.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; In earlier Corosync releases (pre-2.0), the
&lt;code&gt;corosync-cmapctl&lt;/code&gt; tool was called &lt;code&gt;corosync-objctl&lt;/code&gt;. Its command
syntax for querying the member list was identical.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;This article originally appeared on the &lt;code&gt;hastexo.com&lt;/code&gt; website (now defunct).&lt;/p&gt;</content><category term="hints-and-kinks"></category><category term="Corosync"></category></entry></feed>