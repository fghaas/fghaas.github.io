
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index,follow" />


    <link rel="stylesheet" type="text/css" href="../../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../../theme/pygments/github.min.css">

    <link rel="stylesheet" 
    href="../../../theme/tipuesearch/tipuesearch.min.css" />


  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/css/override.css">

  <link rel="shortcut icon" href="https://xahteiwi.eu/favicon.svg" type="image/x-icon">
  <link rel="icon" href="https://xahteiwi.eu/favicon.svg" type="image/x-icon">


  <link href="https://xahteiwi.eu/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="xahteiwi.eu Atom">

  <link href="https://xahteiwi.eu/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="xahteiwi.eu RSS">


 

<meta name="author" content="Florian Haas" />
<meta name="description" content="Whenever a DRBD setup runs into a situation where the replication network is disconnected and fencing policy is set to dont-care (default), there is the potential risk of a split-brain. Even with resource level fencing or STONITH setup, there are corner cases that will end up in a split-brain. When …" />
<meta name="keywords" content="DRBD">


  <meta property="og:site_name" content="xahteiwi.eu"/>
  <meta property="og:title" content="Solve a DRBD split-brain in 4 steps"/>
  <meta property="og:description" content="Whenever a DRBD setup runs into a situation where the replication network is disconnected and fencing policy is set to dont-care (default), there is the potential risk of a split-brain. Even with resource level fencing or STONITH setup, there are corner cases that will end up in a split-brain. When …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../../resources/hints-and-kinks/solve-drbd-split-brain-4-steps/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2012-03-06 01:29:24+01:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../../author/florian-haas.html">
  <meta property="article:section" content="hints-and-kinks"/>
  <meta property="article:tag" content="DRBD"/>
  <meta property="og:image" content="https://xahteiwi.eu/images/avatar.jpg">

  <title>xahteiwi.eu &ndash; Solve a DRBD split-brain in 4 steps</title>


</head>
<body >

<aside>
  <div>
    <a href="../../../">
      <img src="https://xahteiwi.eu/images/avatar.jpg" alt="" title="">
    </a>

    <h1>
      <a href="../../../"></a>
    </h1>


    <form class="navbar-search" action="../../../search.html" role="search">
      <input type="text" name="q" id="tipue_search_input" placeholder="Search...">
    </form>


    <ul class="social">
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://mastodon.social/@xahteiwi"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://fedifreu.de/@xahteiwi"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/fghaas"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-xing"
           href="https://www.xing.com/profile/Florian_Haas2/"
           target="_blank">
          <i class="fa-brands fa-xing"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/fghaas"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-rss"
           href="/feeds/all.rss.xml"
           target="_blank">
          <i class="fa-solid fa-rss"></i>
        </a>
      </li>
      <li>
        <a class="sc-envelope"
rel="me"           href="mailto:xahteiwi+ifyoudontremovethisyoullgostraighttodevnull@mailbox.org"
           target="_blank">
          <i class="fa-solid fa-envelope"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="../../../">Home</a>

  <a href="/category/hints-and-kinks.html">Tech</a>
  <a href="/category/presentations.html">Talks</a>
  <a href="/category/blog.html">Thoughts</a>
  <a href="">​</a>
  <a href="/about/">About</a>
  <a href="/comments/">Comments</a>
  <a href="/legal/">Legal</a>
  <a href="/privacy/">Privacy</a>
  <a href="">​</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>
  <a href="">​</a>

  <a href="https://xahteiwi.eu/feeds/all.atom.xml">Atom</a>

  <a href="https://xahteiwi.eu/feeds/all.rss.xml">RSS</a>
</nav>

<article class="single">
  <header>
      
    <h1 id="solve-drbd-split-brain-4-steps">Solve a DRBD split-brain in 4 steps</h1>
    <p>
      Posted on Tue 06 March 2012 in <a href="../../../category/hints-and-kinks.html">hints-and-kinks</a>

        &#8226; 3 min read
    </p>
  </header>


  <div>
    <p>Whenever a DRBD setup runs into a situation where the replication
network is disconnected and fencing policy is set to <code>dont-care</code>
(default), there is the potential risk of a split-brain. Even with
resource level fencing or STONITH setup, there are corner cases that
will end up in a split-brain.</p>
<p>When your DRBD resource is in a split-brain situation, don’t panic!
Split-brain means that the contents of the backing devices of your
DRBD resource on both sides of your cluster started to diverge. At
some point in time, the DRBD resource on both nodes went into the
Primary role while the cluster nodes themselves were disconnected from
each other.</p>
<p>Different writes happened to both sides of your cluster
afterwards. After reconnecting, DRBD doesn’t know which set of data is
“right” and which is “wrong”.</p>
<h2>Indications of a Split-Brain</h2>
<p>The symptoms of a split-brain are that the peers will not reconnect on
DRBD startup but stay in connection state StandAlone or
WFConnection. The latter will be shown if the remote peer detected the
split-brain earlier and was faster at shutdown its connection. In your
kernel logs you will see messages like:</p>
<div class="highlight"><pre><span></span><code><span class="n">kernel</span><span class="o">:</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">drbd0</span><span class="o">:</span><span class="w"> </span><span class="n">Split</span><span class="o">-</span><span class="n">Brain</span><span class="w"> </span><span class="n">detected</span><span class="o">,</span><span class="w"> </span><span class="n">dropping</span><span class="w"> </span><span class="n">connection</span><span class="o">!</span>
</code></pre></div>
<h2>4 Steps to solve the Split-Brain</h2>
<h3>Step 1</h3>
<p>Manually choose a node which data modifications will be discarded.</p>
<p>We call it the split brain victim. Choose wisely, all modifications
will be lost! When in doubt run a backup of the victim’s data before
you continue.</p>
<p>When running a Pacemaker cluster, you can enable maintenance mode. If
the split brain victim is in Primary role, bring down all applications
using this resource. Now switch the victim to Secondary role:</p>
<div class="highlight"><pre><span></span><code>victim# drbdadm secondary resource
</code></pre></div>
<h3>Step 2</h3>
<p>Disconnect the resource if it’s in connection state <code>WFConnection</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">victim</span>#<span class="w"> </span><span class="nv">drbdadm</span><span class="w"> </span><span class="k">disconnect</span><span class="w"> </span><span class="nv">resource</span>
</code></pre></div>
<h3>Step 3</h3>
<p>Force discard of all modifications on the split brain victim:</p>
<div class="highlight"><pre><span></span><code><span class="nv">victim</span>#<span class="w"> </span><span class="nv">drbdadm</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="nv">discard</span><span class="o">-</span><span class="nv">my</span><span class="o">-</span><span class="nv">data</span><span class="w"> </span><span class="k">connect</span><span class="w"> </span><span class="nv">resource</span>
</code></pre></div>
<p>for DRBD 8.4.x:</p>
<div class="highlight"><pre><span></span><code><span class="nv">victim</span>#<span class="w"> </span><span class="nv">drbdadm</span><span class="w"> </span><span class="k">connect</span><span class="w"> </span><span class="o">--</span><span class="nv">discard</span><span class="o">-</span><span class="nv">my</span><span class="o">-</span><span class="nv">data</span><span class="w"> </span><span class="nv">resource</span>
</code></pre></div>
<h3>Step 4</h3>
<p>Resync will start automatically if the survivor was in
<code>WFConnection</code> network state. If the split brain survivor is still in
<code>Standalone</code> connection state, reconnect it:</p>
<div class="highlight"><pre><span></span><code><span class="nv">survivor</span>#<span class="w"> </span><span class="nv">drbdadm</span><span class="w"> </span><span class="k">connect</span><span class="w"> </span><span class="nv">resource</span>
</code></pre></div>
<p>At the latest now the resynchronization from the survivor
(<code>SyncSource</code>) to the victim (<code>SyncTarget</code>) starts immediately. There
is no full sync initiated but all modifications on the victim will be
overwritten by the survivor’s data and modifications on the survivor
will be applied to the victim.</p>
<h2>Background: What happens?</h2>
<p>With the default after-split-brain policies of disconnect this will
happen always in dual primary setups. It can happen in single primary
setups if one peer changes at least once its role from Secondary to
Primary while disconnected from the previous (before network
interruption) Primary.</p>
<p>There are a variety of automatic policies to solve a split brain but
some of them will overwrite (potentially valid) data without further
inquiry. Even with theses policies in place a unresolvable split-brain
can occur.</p>
<p>The split-brain is detected once the peers reconnect and do their DRBD
protocol handshake which also includes exchanging of the Generation
Identifiers (GIs).</p>
<hr/>
<p>This article originally appeared on the <code>hastexo.com</code> website (now defunct).</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../../tag/drbd.html">DRBD</a>
    </p>
  </div>






</article>

<footer>
<p>
  &copy; 2025  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike License</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " xahteiwi.eu ",
  "url" : "../../..",
  "image": "https://xahteiwi.eu/images/avatar.jpg",
  "description": ""
}
</script>
</body>
</html>