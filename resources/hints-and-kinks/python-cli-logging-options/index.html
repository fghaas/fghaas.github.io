
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index,follow" />


    <link rel="stylesheet" type="text/css" href="../../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../../theme/pygments/github.min.css">

    <link rel="stylesheet" 
    href="../../../theme/tipuesearch/tipuesearch.min.css" />


  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/css/override.css">



  <link href="https://xahteiwi.eu/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="xahteiwi.eu Atom">

  <link href="https://xahteiwi.eu/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="xahteiwi.eu RSS">


<script defer data-domain="xahteiwi.eu" src="https://plausible.io/js/plausible.js"></script>

 

<meta name="author" content="Florian Haas" />
<meta name="description" content="Command-line interfaces frequently produce output whose verbosity your users may want to be able to tweak. Here’s a nifty way to do that." />
<meta name="keywords" content="Python">


  <meta property="og:site_name" content="xahteiwi.eu"/>
  <meta property="og:title" content="Configuring CLI output verbosity with logging and argparse"/>
  <meta property="og:description" content="Command-line interfaces frequently produce output whose verbosity your users may want to be able to tweak. Here’s a nifty way to do that."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../../resources/hints-and-kinks/python-cli-logging-options/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2019-05-01 00:00:00+00:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../../author/florian-haas.html">
  <meta property="article:section" content="hints-and-kinks"/>
  <meta property="article:tag" content="Python"/>
  <meta property="og:image" content="https://xahteiwi.eu/images/avatar.jpg">

  <title>xahteiwi.eu &ndash; Configuring CLI output verbosity with logging and argparse</title>


</head>
<body >

<aside>
  <div>
    <a href="../../../">
      <img src="https://xahteiwi.eu/images/avatar.jpg" alt="" title="">
    </a>

    <h1>
      <a href="../../../"></a>
    </h1>


    <form class="navbar-search" action="../../../search.html" role="search">
      <input type="text" name="q" id="tipue_search_input" placeholder="Search...">
    </form>


    <ul class="social">
      <li>
        <a class="sc-twitter"
           href="https://twitter.com/xahteiwi"
           target="_blank">
          <i class="fa-brands fa-twitter"></i>
        </a>
      </li>
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://mastodon.social/@xahteiwi"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/fghaas"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/fghaas"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="../../../">Home</a>

  <a href="/category/hints-and-kinks.html">Tech</a>
  <a href="/category/presentations.html">Talks</a>
  <a href="/category/blog.html">Thoughts</a>
  <a href="">​</a>
  <a href="/about/">About</a>
  <a href="/comments/">Comments</a>
  <a href="/legal/">Legal</a>
  <a href="/privacy/">Privacy</a>
  <a href="">​</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>
  <a href="">​</a>

  <a href="https://xahteiwi.eu/feeds/all.atom.xml">Atom</a>

  <a href="https://xahteiwi.eu/feeds/all.rss.xml">RSS</a>
</nav>

<article class="single">
  <header>
      
    <h1 id="python-cli-logging-options">Configuring CLI output verbosity with logging and argparse</h1>
    <p>
      Posted on Wed 01 May 2019 in <a href="../../../category/hints-and-kinks.html">hints-and-kinks</a>

        &#8226; 4 min read
    </p>
  </header>


  <div>
    <p>In a Python command-line interface (CLI) utility, you will want to
inform your users about what your program is doing. Your will also
want to give your users the ability to tweak how verbose that output
is. Now there is a de-facto standard convention for doing that, which
most CLIs — Python or otherwise — tend to adhere to:</p>
<ul>
<li>By default, show messages only about errors and warning conditions.</li>
<li>Define a <code>-v</code> or <code>--verbose</code> option that makes your program also
  show messages that are merely informative in nature.</li>
<li>Optionally, allow users to repeat the <code>-v</code> option, making the
  program even more verbose (to include, for example, debug output).</li>
<li>Conversely, also define a <code>-q</code> or <code>--quiet</code> (alternatively
  <code>-s</code>/<code>--silent</code>) option that, when set, makes the program suppress
  warnings and show only errors — i.e. the stuff that your program
  shows if it exits with a nonzero exit code.</li>
<li>Log output that tells users about what the program is doing, as it
  goes along, to the standard error (stderr) stream, whereas the
  output related to the program’s <em>results</em> goes to standard output
  (stdout). This gives your users the ability to pipe stdout to a file
  or another program, and your progress or status messages won’t
  interfere with that.</li>
</ul>
<p>And in Python it’s not at all difficult to do that!</p>
<h2><code>argparse</code> options</h2>
<p>First, we’ll want to define a couple of options <a href="https://docs.python.org/3/library/argparse.html">for our
<code>argparse.ArgumentParser</code>
object</a>, which in the
following snippet I’ve named <code>parser</code>. Define two options, like so:<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></p>
<div class="highlight"><pre><span></span><code><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-v'</span><span class="p">,</span> <span class="s1">'--verbose'</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s1">'count'</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="s1">'verbosity'</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">"verbose output (repeat for increased verbosity)"</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-q'</span><span class="p">,</span> <span class="s1">'--quiet'</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s1">'store_const'</span><span class="p">,</span>
                    <span class="n">const</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="s1">'verbosity'</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">"quiet output (show errors only)"</span><span class="p">)</span>
</code></pre></div>
<p>From this, we get two command-line options:</p>
<ul>
<li>
<p><code>-v</code> or <code>--verbose</code>, which can be repeated, sets <code>verbosity</code>, which
  defaults to 0. <code>action='count'</code> means that if you invoke your CLI
  with <code>-v</code>, <code>verbosity</code> is 1, <code>-vv</code> sets <code>verbosity</code> to 2, etc.</p>
</li>
<li>
<p><code>-q</code> or <code>--quiet</code> <em>also</em> sets <code>verbosity</code>, but to a constant value,
  -1, via <code>store_const</code>.</p>
</li>
</ul>
<h2>Setting up the <code>logging</code> subsystem</h2>
<p>What we’ll want to do is use <a href="https://docs.python.org/3/library/logging.html">the <code>logging</code>
subsystem</a> to send our
status, progress, and error messages to stderr.</p>
<p>First, you can translate <code>verbosity</code> into a logging level understood
by the <code>logging</code> module. Here’s a little convenience method that
achieves that:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">setup_logging</span><span class="p">(</span><span class="n">verbosity</span><span class="p">):</span>
    <span class="n">base_loglevel</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">verbosity</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">verbosity</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">loglevel</span> <span class="o">=</span> <span class="n">base_loglevel</span> <span class="o">-</span> <span class="p">(</span><span class="n">verbosity</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">loglevel</span><span class="p">,</span>
                        <span class="nb">format</span><span class="o">=</span><span class="s1">'</span><span class="si">%(message)s</span><span class="s1">'</span><span class="p">)</span>
</code></pre></div>
<p>Now what does this do? Python log levels go from 10 (<code>logging.DEBUG</code>)
to 50 (<code>logging.CRITICAL</code>) in intervals of 10; our <code>verbosity</code>
argument goes from -1 (<code>-q</code>) to 2 (<code>-vv</code>).<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup> We never want to
suppress error and critical messages, and default to 30
(<code>logging.WARNING</code>). So we multiply <code>verbosity</code> by 10, and subtract
that from our base loglevel of 30.</p>
<p>With <code>-v</code>, that sets our effective log level to 20 (<code>logging.INFO</code>);
with <code>-vv</code>, to 10 (<code>logging.DEBUG</code>). And with <code>-q</code>
(i.e. <code>verbosity==-1</code>), our log level becomes 40 (<code>logging.ERROR</code>).</p>
<p>Now we can use <code>logging.basicConfig()</code> to configure the logging
subsystem to send unadorned log messages with the desired loglevel or
above, to stderr: <code>basicConfig()</code>, <a href="https://docs.python.org/3/library/logging.html#logging.basicConfig">by
default</a>,
sets up a <code>StreamHandler</code> whose output stream is <code>sys.stderr</code>, so it
already does what we want here. And setting <code>format='%(message)s'</code>
strips the <code>LEVEL:logger:</code> prefix that <code>basicConfig()</code> would otherwise
include in the log line (and which is helpful for log files, but not
so much for CLI output).</p>
<p>From then on, every time your program should write an informational
message to stderr, you just use <code>logging.info()</code>, for a debug message,
<code>logging.debug()</code>, and so on.</p>
<h2>Adding an environment variable</h2>
<p>In some circumstances you might <em>always</em> want debug output, and
invoking your CLI with <code>-vv</code> all the time might not be practical. (CI
systems are an example — you generally want your build logs as verbose
as possible.) You can make your users’ lives easier by optionally
fixing up your logging subsystem with an environment variable, like so:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">setup_logging</span><span class="p">(</span><span class="n">verbosity</span><span class="p">):</span>
    <span class="n">base_loglevel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'LOGLEVEL'</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span> 
    <span class="n">verbosity</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">verbosity</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">loglevel</span> <span class="o">=</span> <span class="n">base_loglevel</span> <span class="o">-</span> <span class="p">(</span><span class="n">verbosity</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">loglevel</span><span class="p">,</span>
                        <span class="nb">format</span><span class="o">=</span><span class="s1">'</span><span class="si">%(message)s</span><span class="s1">'</span><span class="p">)</span>
</code></pre></div>
<p>This way, if you invoke your CLI with <code>LOGLEVEL=10</code> in its
environment, it will always use debug output. </p>
<p>Perhaps you’d like to make this even easier, allowing your users to
also set <code>LOGLEVEL</code> to <code>debug</code>, <code>INFO</code>, <code>erRoR</code> and whatever
else. That you could do like this:<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">setup_logging</span><span class="p">(</span><span class="n">verbosity</span><span class="p">):</span>
    <span class="n">base_loglevel</span> <span class="o">=</span> <span class="n">gettattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> 
                             <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'LOGLEVEL'</span><span class="p">,</span> <span class="s1">'WARNING'</span><span class="p">))</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> 
    <span class="n">verbosity</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">verbosity</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">loglevel</span> <span class="o">=</span> <span class="n">base_loglevel</span> <span class="o">-</span> <span class="p">(</span><span class="n">verbosity</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">loglevel</span><span class="p">,</span>
                        <span class="nb">format</span><span class="o">=</span><span class="s1">'</span><span class="si">%(message)s</span><span class="s1">'</span><span class="p">)</span>
</code></pre></div>
<h2>Parting thought</h2>
<p>One of the many ways in which using <code>logging</code> comes in handy in a CLI
is in a catch-all exception handler:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errno</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>This way, unhandled exceptions will show merely the exception message
by default, but if and only if debug logging is enabled, your users
will also see a stack trace.</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:1">
<p>This is used
<a href="https://github.com/hastexo/olx-utils/blob/v0.3.0/olxutils/cli.py#L53">here</a>. <a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:2">
<p>There is, to the best of my knowledge, no way to limit the
number of repeats for an argument with <code>action='count'</code>. Hence the
construct with the <code>min()</code> built-in function. <a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:3">
<p>A variation of this is used
<a href="https://github.com/hastexo/olx-utils/blob/v0.3.0/olxutils/cli.py#L284">here</a>. <a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
</ol>
</div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../../tag/python.html">Python</a>
    </p>
  </div>




  <div class="related-posts">
    <h4>Part 2 of "Nifty Python tricks"</h4>
       <h5>Previous articles</h5>
       <ul>
           <li><a href="../../../resources/hints-and-kinks/python-argparse-from-dictionary/">Building a nested CLI parser from a dictionary</a></li>
       </ul>
  </div>


</article>

<footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike License</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " xahteiwi.eu ",
  "url" : "../../..",
  "image": "https://xahteiwi.eu/images/avatar.jpg",
  "description": ""
}
</script>
</body>
</html>