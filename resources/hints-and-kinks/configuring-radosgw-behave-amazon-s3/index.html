
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index,follow" />


    <link rel="stylesheet" type="text/css" href="../../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../../theme/pygments/github.min.css">

    <link rel="stylesheet" 
    href="../../../theme/tipuesearch/tipuesearch.min.css" />


  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/css/override.css">

  <link rel="shortcut icon" href="https://xahteiwi.eu/favicon.svg" type="image/x-icon">
  <link rel="icon" href="https://xahteiwi.eu/favicon.svg" type="image/x-icon">


  <link href="https://xahteiwi.eu/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="xahteiwi.eu Atom">

  <link href="https://xahteiwi.eu/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="xahteiwi.eu RSS">


 

<meta name="author" content="Florian Haas" />
<meta name="description" content="If you’ve heard of Ceph, you’ve surely heard of radosgw, a RESTful gateway interface to the RADOS object store. You’ve probably also heard that it provides a front-end interface that is compatible with Amazon’s S3 API. The question remains, if you have an S3 client that …" />
<meta name="keywords" content="Ceph">


  <meta property="og:site_name" content="xahteiwi.eu"/>
  <meta property="og:title" content="Configuring radosgw to behave like Amazon S3"/>
  <meta property="og:description" content="If you’ve heard of Ceph, you’ve surely heard of radosgw, a RESTful gateway interface to the RADOS object store. You’ve probably also heard that it provides a front-end interface that is compatible with Amazon’s S3 API. The question remains, if you have an S3 client that …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../../resources/hints-and-kinks/configuring-radosgw-behave-amazon-s3/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2012-07-09 08:15:57+01:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../../author/florian-haas.html">
  <meta property="article:section" content="hints-and-kinks"/>
  <meta property="article:tag" content="Ceph"/>
  <meta property="og:image" content="https://xahteiwi.eu/images/avatar.jpg">

  <title>xahteiwi.eu &ndash; Configuring radosgw to behave like Amazon S3</title>


</head>
<body >

<aside>
  <div>
    <a href="../../../">
      <img src="https://xahteiwi.eu/images/avatar.jpg" alt="" title="">
    </a>

    <h1>
      <a href="../../../"></a>
    </h1>


    <form class="navbar-search" action="../../../search.html" role="search">
      <input type="text" name="q" id="tipue_search_input" placeholder="Search...">
    </form>


    <ul class="social">
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://mastodon.social/@xahteiwi"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://fedifreu.de/@xahteiwi"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/fghaas"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-xing"
           href="https://www.xing.com/profile/Florian_Haas2/"
           target="_blank">
          <i class="fa-brands fa-xing"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/fghaas"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-rss"
           href="/feeds/all.rss.xml"
           target="_blank">
          <i class="fa-solid fa-rss"></i>
        </a>
      </li>
      <li>
        <a class="sc-envelope"
rel="me"           href="mailto:xahteiwi+ifyoudontremovethisyoullgostraighttodevnull@mailbox.org"
           target="_blank">
          <i class="fa-solid fa-envelope"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="../../../">Home</a>

  <a href="/category/hints-and-kinks.html">Tech</a>
  <a href="/category/presentations.html">Talks</a>
  <a href="/category/blog.html">Thoughts</a>
  <a href="">​</a>
  <a href="/about/">About</a>
  <a href="/comments/">Comments</a>
  <a href="/legal/">Legal</a>
  <a href="/privacy/">Privacy</a>
  <a href="">​</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>
  <a href="">​</a>

  <a href="https://xahteiwi.eu/feeds/all.atom.xml">Atom</a>

  <a href="https://xahteiwi.eu/feeds/all.rss.xml">RSS</a>
</nav>

<article class="single">
  <header>
      
    <h1 id="configuring-radosgw-behave-amazon-s3">Configuring radosgw to behave like Amazon S3</h1>
    <p>
      Posted on Mon 09 July 2012 in <a href="../../../category/hints-and-kinks.html">hints-and-kinks</a>

        &#8226; 3 min read
    </p>
  </header>


  <div>
    <p>If you’ve heard of Ceph, you’ve surely heard of radosgw, a RESTful
gateway interface to the RADOS object store. You’ve probably also
heard that it provides a front-end interface that is compatible with
Amazon’s S3 API.</p>
<p>The question remains, if you have an S3 client that always assumes it
can find objects at http://bucket.s3.amazonaws.com, how can you use
such a client to interact, unmodified, with your radosgw host (or
hosts)?</p>
<p>Pulling this off is actually remarkably simple, if you can control
what nameserver your clients use to resolve DNS names. Which should be
a given in the private cloud space.</p>
<p>First, of course, you’ll need an installed and configured Ceph cluster
with one or several radosgw nodes. The Ceph documentation is an
excellent reference for setting up radosgw.</p>
<h2>Configuring radosgw to support virtual hosts</h2>
<p>Then, you make sure you have the following entry in your Ceph configuration (normally in /etc/ceph/ceph.conf):</p>
<div class="highlight"><pre><span></span><code><span class="k">[client.radosgw.charlie]</span>
<span class="w">  </span><span class="na">rgw dns name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">s3.amazonaws.com</span>
</code></pre></div>
<p>Substitute charlie with whatever name you want to use for your radosgw
client when you interact with Ceph. What the rgw dns name option
specifies is that radosgw will answer queries also for URLs like
http://bucket.hostname/object, as opposed to just
http://hostname/bucket/object.</p>
<h2>Configuring Apache to respond to S3 host names</h2>
<p>Also, add a wildcard record to the ServerAlias directive in the web server configuration for your radosgw host. For example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">*:80</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nb">ServerName</span><span class="w"> </span>radosgw.example.com
<span class="w">    </span><span class="nb">ServerAlias</span><span class="w"> </span>s3.amazonaws.com
<span class="w">    </span><span class="nb">ServerAlias</span><span class="w"> </span>*.amazonaws.com
</code></pre></div>
<h2>Configuring your DNS server</h2>
<p>Then, set up your DNS server with a wildcard record in the
s3.amazonaws.com zone, and have nameserver respond to requests in that
zone. The zone file (for BIND9, in this case) could look like this:</p>
<div class="highlight"><pre><span></span><code>$TTL    604800
@   IN  SOA alice.example.com. root.alice.example.com. (
                  2     ; Serial
             604800     ; Refresh
              86400     ; Retry
            2419200     ; Expire
             604800 )   ; Negative Cache TTL
;
@   IN  NS  alice.example.com.
@   IN  A   192.168.122.113
<span class="k">*</span>   IN  CNAME   @
</code></pre></div>
<p>In this zone, the A record s3.amazonaws.com resolves
to 192.168.122.113, and any sub-domain (like
mybucket.s3.amazonaws.com) also resolves to that same address via a
CNAME record.</p>
<h2>Using your RADOS store with S3 clients</h2>
<p>And then you just configure your client hosts to resolve DNS names via
that nameserver, and use your preferred client application to interact
with it.</p>
<p>For example, for a user that you’ve created with radosgw-admin, which
uses the access key 12345 with a secret of 67890, and Mark Atwood’s
popular <code>Net::Amazon::S3::Tools</code> toolkit, here’s how you can interact
with your RADOS objects:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># export AWS_ACCESS_KEY_ID=12345</span>
<span class="c1"># export AWS_ACCESS_KEY_SECRET=67890</span>
<span class="c1"># s3mkbucket mymostawesomebucket</span>
<span class="c1"># s3ls</span>
<span class="n">mymostawesomebucket</span>
<span class="c1"># s3put mymostawesomebucket/foobar &lt;&lt;&lt; "hello world"</span>
<span class="c1"># s3ls mymostawesomebucket</span>
<span class="n">foobar</span>
<span class="c1"># s3get mymostawesomebucket/foobar</span>
<span class="n">hello</span><span class="w"> </span><span class="n">world</span>
</code></pre></div>
<p>Simple enough. You can add one more nifty feature.</p>
<h2>Adding load balancing</h2>
<p>radosgw can scale horizontally, and all you need to do to make this
work is to duplicate your radosgw and Apache configuration onto a
different host, and then add a second record to your DNS zone:</p>
<div class="highlight"><pre><span></span><code>$TTL    604800
@   IN  SOA alice.example.com. root.alice.example.com. (
                  3     ; Serial
             604800     ; Refresh
              86400     ; Retry
            2419200     ; Expire
             604800 )   ; Negative Cache TTL
;
@   IN  NS  alice.example.com.
@   IN  A   192.168.122.112
@   IN  A   192.168.122.113
<span class="k">*</span>   IN  CNAME   @
</code></pre></div>
<p>Then, as you access more buckets, you’ll hit the A records in a
round-robin fashion, meaning your requests will be balanced across the
servers. Add as many as you like.</p>
<h2>HTTPS support</h2>
<p>Obviously, the above steps will not work for HTTPS connections to the
REST API. And really, making that work would amount to some pretty
terrible SSL certificate authority and client trust hackery, so just
don’t do it.</p>
<hr/>
<p>This article originally appeared on the <code>hastexo.com</code> website (now defunct).</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../../tag/ceph.html">Ceph</a>
    </p>
  </div>






</article>

<footer>
<p>
  &copy; 2024  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike License</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " xahteiwi.eu ",
  "url" : "../../..",
  "image": "https://xahteiwi.eu/images/avatar.jpg",
  "description": ""
}
</script>
</body>
</html>