
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index,follow" />


    <link rel="stylesheet" type="text/css" href="../../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../../theme/pygments/github.min.css">

    <link rel="stylesheet" 
    href="../../../theme/tipuesearch/tipuesearch.min.css" />


  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/css/override.css">

  <link rel="shortcut icon" href="https://xahteiwi.eu/favicon.svg" type="image/x-icon">
  <link rel="icon" href="https://xahteiwi.eu/favicon.svg" type="image/x-icon">


  <link href="https://xahteiwi.eu/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="xahteiwi.eu Atom">

  <link href="https://xahteiwi.eu/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="xahteiwi.eu RSS">



<script defer data-domain="xahteiwi.eu" src="https://plausible.io/js/plausible.js"></script>




 

<meta name="author" content="Florian Haas" />
<meta name="description" content="Setting up OCFS2 in Pacemaker requires configuring the Pacemaker DLM, the O2CB lock manager for OCFS2, and an OCFS2 filesystem itself. Prerequisites OCFS2 with Pacemaker integration is supported on Debian (squeeze-backports and up) and Ubuntu (10.04 LTS and up). You’ll need the dlm-pcmk, ocfs2-tools, ocfs2-tools-pacemaker and openais packages …" />
<meta name="keywords" content="Pacemaker">


  <meta property="og:site_name" content="xahteiwi.eu"/>
  <meta property="og:title" content="OCFS2 in Pacemaker (Debian/Ubuntu)"/>
  <meta property="og:description" content="Setting up OCFS2 in Pacemaker requires configuring the Pacemaker DLM, the O2CB lock manager for OCFS2, and an OCFS2 filesystem itself. Prerequisites OCFS2 with Pacemaker integration is supported on Debian (squeeze-backports and up) and Ubuntu (10.04 LTS and up). You’ll need the dlm-pcmk, ocfs2-tools, ocfs2-tools-pacemaker and openais packages …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../../resources/hints-and-kinks/ocfs2-pacemaker-debianubuntu/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2012-02-24 17:01:20+01:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../../author/florian-haas.html">
  <meta property="article:section" content="hints-and-kinks"/>
  <meta property="article:tag" content="Pacemaker"/>
  <meta property="og:image" content="https://xahteiwi.eu/images/avatar.jpg">

  <title>xahteiwi.eu &ndash; OCFS2 in Pacemaker (Debian/Ubuntu)</title>


</head>
<body >

<aside>
  <div>
    <a href="../../../">
      <img src="https://xahteiwi.eu/images/avatar.jpg" alt="" title="">
    </a>

    <h1>
      <a href="../../../"></a>
    </h1>


    <form class="navbar-search" action="../../../search.html" role="search">
      <input type="text" name="q" id="tipue_search_input" placeholder="Search...">
    </form>


    <ul class="social">
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://mastodon.social/@xahteiwi"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://fedifreu.de/@xahteiwi"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/fghaas"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-xing"
           href="https://www.xing.com/profile/Florian_Haas2/"
           target="_blank">
          <i class="fa-brands fa-xing"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/fghaas"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-rss"
           href="/feeds/all.rss.xml"
           target="_blank">
          <i class="fa-solid fa-rss"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="../../../">Home</a>

  <a href="/category/hints-and-kinks.html">Tech</a>
  <a href="/category/presentations.html">Talks</a>
  <a href="/category/blog.html">Thoughts</a>
  <a href="">​</a>
  <a href="/about/">About</a>
  <a href="/comments/">Comments</a>
  <a href="/legal/">Legal</a>
  <a href="/privacy/">Privacy</a>
  <a href="">​</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>
  <a href="">​</a>

  <a href="https://xahteiwi.eu/feeds/all.atom.xml">Atom</a>

  <a href="https://xahteiwi.eu/feeds/all.rss.xml">RSS</a>
</nav>

<article class="single">
  <header>
      
    <h1 id="ocfs2-pacemaker-debianubuntu">OCFS2 in Pacemaker (Debian/Ubuntu)</h1>
    <p>
      Posted on Fri 24 February 2012 in <a href="../../../category/hints-and-kinks.html">hints-and-kinks</a>

        &#8226; 2 min read
    </p>
  </header>


  <div>
    <p>Setting up OCFS2 in Pacemaker requires configuring the Pacemaker DLM,
the O2CB lock manager for OCFS2, and an OCFS2 filesystem itself.</p>
<h2>Prerequisites</h2>
<ul>
<li>
<p>OCFS2 with Pacemaker integration is supported on Debian
  (<code>squeeze-backports</code> and up) and Ubuntu (10.04 LTS and up). You’ll
  need the <code>dlm-pcmk</code>, <code>ocfs2-tools</code>, <code>ocfs2-tools-pacemaker</code> and
  <code>openais</code> packages.</p>
</li>
<li>
<p>Fencing is imperative. Get a proper fencing/STONITH configuration
  set up and test it thoroughly.</p>
</li>
<li>
<p>Running OCFS2/Pacemaker integration requires that you load Corosync
  with the <code>openais_ckpt</code> service enabled. The service definition is in
  the file <code>/etc/corosync/service.d/ckpt-service</code> which the <code>openais</code>
  package installs by default. Make sure you did not accidentally
  delete or disable this file.</p>
</li>
</ul>
<h2>Pacemaker configuration</h2>
<p>The Pacemaker configuration, shown here in crm shell syntax, normally
puts all the required resources into one cloned group. Have a look at
this configuration snippet:</p>
<div class="highlight"><pre><span></span><code><span class="nx">primitive</span><span class="w"> </span><span class="nx">p_dlm_controld</span><span class="w"> </span><span class="nx">ocf</span><span class="p">:</span><span class="nx">pacemaker</span><span class="p">:</span><span class="nx">controld</span><span class="w"> </span>\
<span class="w">  </span><span class="nx">op</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">interval</span><span class="p">=</span><span class="s">"0"</span><span class="w"> </span><span class="nx">timeout</span><span class="p">=</span><span class="s">"90"</span><span class="w"> </span>\
<span class="w">  </span><span class="nx">op</span><span class="w"> </span><span class="nx">stop</span><span class="w"> </span><span class="nx">interval</span><span class="p">=</span><span class="s">"0"</span><span class="w"> </span><span class="nx">timeout</span><span class="p">=</span><span class="s">"100"</span><span class="w"> </span>\
<span class="w">  </span><span class="nx">op</span><span class="w"> </span><span class="nx">monitor</span><span class="w"> </span><span class="nx">interval</span><span class="p">=</span><span class="s">"10"</span>
<span class="nx">primitive</span><span class="w"> </span><span class="nx">p_o2cb</span><span class="w"> </span><span class="nx">ocf</span><span class="p">:</span><span class="nx">pacemaker</span><span class="p">:</span><span class="nx">o2cb</span><span class="w"> </span>\
<span class="w">  </span><span class="nx">op</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">interval</span><span class="p">=</span><span class="s">"0"</span><span class="w"> </span><span class="nx">timeout</span><span class="p">=</span><span class="s">"90"</span><span class="w"> </span>\
<span class="w">  </span><span class="nx">op</span><span class="w"> </span><span class="nx">stop</span><span class="w"> </span><span class="nx">interval</span><span class="p">=</span><span class="s">"0"</span><span class="w"> </span><span class="nx">timeout</span><span class="p">=</span><span class="s">"100"</span><span class="w"> </span>\
<span class="w">  </span><span class="nx">op</span><span class="w"> </span><span class="nx">monitor</span><span class="w"> </span><span class="nx">interval</span><span class="p">=</span><span class="s">"10"</span>
<span class="nx">primitive</span><span class="w"> </span><span class="nx">p_fs_ocfs2</span><span class="w"> </span><span class="nx">ocf</span><span class="p">:</span><span class="nx">heartbeat</span><span class="p">:</span><span class="nx">Filesystem</span><span class="w"> </span>\
<span class="w">  </span><span class="nx">params</span><span class="w"> </span><span class="nx">device</span><span class="p">=</span><span class="s">"&lt;your device path&gt;"</span><span class="w"> </span>\
<span class="w">    </span><span class="nx">directory</span><span class="p">=</span><span class="s">"&lt;your mount point&gt;"</span><span class="w"> </span>\
<span class="w">    </span><span class="nx">fstype</span><span class="p">=</span><span class="s">"ocfs2"</span><span class="w"> </span>\
<span class="w">  </span><span class="nx">meta</span><span class="w"> </span><span class="nx">target</span><span class="o">-</span><span class="nx">role</span><span class="p">=</span><span class="nx">Stopped</span><span class="w"> </span>\
<span class="w">  </span><span class="nx">op</span><span class="w"> </span><span class="nx">monitor</span><span class="w"> </span><span class="nx">interval</span><span class="p">=</span><span class="s">"10"</span>
<span class="nx">group</span><span class="w"> </span><span class="nx">g_ocfs2</span><span class="w"> </span><span class="nx">p_dlm_controld</span><span class="w"> </span><span class="nx">p_o2cb</span><span class="w"> </span><span class="nx">p_fs_ocfs2</span>
<span class="nx">clone</span><span class="w"> </span><span class="nx">cl_ocfs2</span><span class="w"> </span><span class="nx">g_ocfs2</span><span class="w"> </span>\
<span class="w">  </span><span class="nx">meta</span><span class="w"> </span><span class="nx">interleave</span><span class="p">=</span><span class="s">"true"</span>
</code></pre></div>
<h2>Why keep the filesystem stopped?</h2>
<p>Because you probably either don’t have a configured OCFS2 filesystem
on your device yet, or your ran mkfs.ocfs2 when the Pacemaker stack
wasn’t running. In either of those two cases, mount.ocfs2 will refuse
to mount the filesystem.</p>
<p>Thus, fire up your DLM and the o2cb process like the above
configuration does, and then:</p>
<ul>
<li>
<p>If you haven’t got a filesystem yet, run <code>mkfs.ocfs2</code> on your device, or</p>
</li>
<li>
<p>If you do already have one, run
  <code>tunefs.ocfs2 --update-cluster-stack &lt;device&gt;</code>.</p>
</li>
</ul>
<p>Then when that’s done, run <code>crm resource start p_fs_ocfs2</code> and your
filesystem should happily mount on all nodes.</p>
<hr/>
<p>This article originally appeared on the <code>hastexo.com</code> website (now defunct).</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../../tag/pacemaker.html">Pacemaker</a>
    </p>
  </div>






</article>

<footer>
<p>
  &copy; 2024  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike License</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " xahteiwi.eu ",
  "url" : "../../..",
  "image": "https://xahteiwi.eu/images/avatar.jpg",
  "description": ""
}
</script>
</body>
</html>