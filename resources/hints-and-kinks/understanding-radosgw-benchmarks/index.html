
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index,follow" />


    <link rel="stylesheet" type="text/css" href="../../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../../theme/pygments/github.min.css">

    <link rel="stylesheet" 
    href="../../../theme/tipuesearch/tipuesearch.min.css" />


  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/css/override.css">

  <link rel="shortcut icon" href="https://xahteiwi.eu/favicon.svg" type="image/x-icon">
  <link rel="icon" href="https://xahteiwi.eu/favicon.svg" type="image/x-icon">


  <link href="https://xahteiwi.eu/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="xahteiwi.eu Atom">

  <link href="https://xahteiwi.eu/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="xahteiwi.eu RSS">


<script defer data-domain="xahteiwi.eu" src="https://plausible.io/js/plausible.js"></script>

 

<meta name="author" content="Florian Haas" />
<meta name="description" content="We’ve noticed that there are a few common misconceptions around radosgw performance, and we’re hoping that this post can clear up some of those. radosgw is of course Ceph’s RESTful object gateway. That means that you can use any client that speaks the Amazon S3 or OpenStack …" />
<meta name="keywords" content="Ceph">


  <meta property="og:site_name" content="xahteiwi.eu"/>
  <meta property="og:title" content="Understanding radosgw benchmarks"/>
  <meta property="og:description" content="We’ve noticed that there are a few common misconceptions around radosgw performance, and we’re hoping that this post can clear up some of those. radosgw is of course Ceph’s RESTful object gateway. That means that you can use any client that speaks the Amazon S3 or OpenStack …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../../resources/hints-and-kinks/understanding-radosgw-benchmarks/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2015-11-18 14:01:42+01:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../../author/florian-haas.html">
  <meta property="article:section" content="hints-and-kinks"/>
  <meta property="article:tag" content="Ceph"/>
  <meta property="og:image" content="https://xahteiwi.eu/images/avatar.jpg">

  <title>xahteiwi.eu &ndash; Understanding radosgw benchmarks</title>


</head>
<body >

<aside>
  <div>
    <a href="../../../">
      <img src="https://xahteiwi.eu/images/avatar.jpg" alt="" title="">
    </a>

    <h1>
      <a href="../../../"></a>
    </h1>


    <form class="navbar-search" action="../../../search.html" role="search">
      <input type="text" name="q" id="tipue_search_input" placeholder="Search...">
    </form>


    <ul class="social">
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://mastodon.social/@xahteiwi"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/fghaas"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/fghaas"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="../../../">Home</a>

  <a href="/category/hints-and-kinks.html">Tech</a>
  <a href="/category/presentations.html">Talks</a>
  <a href="/category/blog.html">Thoughts</a>
  <a href="">​</a>
  <a href="/about/">About</a>
  <a href="/comments/">Comments</a>
  <a href="/legal/">Legal</a>
  <a href="/privacy/">Privacy</a>
  <a href="">​</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>
  <a href="">​</a>

  <a href="https://xahteiwi.eu/feeds/all.atom.xml">Atom</a>

  <a href="https://xahteiwi.eu/feeds/all.rss.xml">RSS</a>
</nav>

<article class="single">
  <header>
      
    <h1 id="understanding-radosgw-benchmarks">Understanding radosgw benchmarks</h1>
    <p>
      Posted on Wed 18 November 2015 in <a href="../../../category/hints-and-kinks.html">hints-and-kinks</a>

        &#8226; 7 min read
    </p>
  </header>


  <div>
    <p>We’ve noticed that there are a few common misconceptions around
radosgw performance, and we’re hoping that this post can clear up some
of those.</p>
<p>radosgw is of course Ceph’s RESTful object gateway. That means that
you can use any client that speaks the Amazon S3 or OpenStack Swift
protocol to interact with your Ceph cluster. Since RESTful object
access is HTTP based, this also means you can combine radosgw with
HTTP load balancers, reverse proxies and the like, which often comes
in handy.</p>
<p>In general, as any RESTful object storage, you would generally store
data in radosgw that you read and write in one chunk, and where bulk
storage is more important than online availability (if you need data
at your fingertips, you’d use RBD or CephFS or even straight-up RADOS
instead, but those are for different use cases).</p>
<p>The performance implications of using radosgw (or any RESTful object
storage, for that matter) usually apply to one of two different use
cases:</p>
<ul>
<li>
<p>Either you want to store lots of data in bulk, and come back to it
  later. This, for example, is why in OpenStack backups of volumes and
  databases typically go to OpenStack Swift or radosgw speaking the
  Swift protocol.</p>
</li>
<li>
<p>Or you want to store lots of relatively small data chunks really
  fast. Suppose you have a monitoring system storing data points in
  S3.</p>
</li>
</ul>
<p>So either you want to write big chunks of data, in which case you’re
interested in throughput (typically measured in amount of data per
unit time, such as MB/s). Or you want to write small chunks, then
what’s important is completed operations per unit time (typically
measured in number of writes per second, which in the RESTful case
would be HTTP PUTs per second).</p>
<p>Now with radosgw, you can measure this with a handy tool called
rest-bench. Sadly rest-bench no longer builds with Ceph for Infernalis
and later, because the Ceph developers now favor Intel’s COSbench
utility. But rest-bench from older Ceph releases will be around for a
while and it’s handy because unlike COSbench, it doesn’t require Java.</p>
<p>So let’s take a look. The general invocation for rest-bench is like
this:</p>
<div class="highlight"><pre><span></span><code>rest-bench<span class="w"> </span>-t<span class="w"> </span><span class="nv">$CONCURRENCY</span><span class="w"> </span>-b<span class="w"> </span><span class="nv">$SIZE</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--seconds<span class="o">=</span><span class="nv">$SECS</span><span class="w"> </span>--api-host<span class="o">=</span><span class="nv">$RGW</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--bucket<span class="o">=</span><span class="nv">$BUCKET</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--access-key<span class="o">=</span><span class="nv">$KEY</span><span class="w"> </span>--secret<span class="o">=</span><span class="nv">$SECRET</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--no-cleanup<span class="w"> </span>write
</code></pre></div>
<p>What does that mean?</p>
<ul>
<li>
<p><code>$CONCURRENCY</code> is the number of concurrently running PUT
  operations. Basically, this is how many clients you want to
  simulate. The default is 16.</p>
</li>
<li>
<p><code>$SIZE</code> is the size of an individual object being written. The default
  here is 4MB.</p>
</li>
<li>
<p><code>$RGW</code> is of course your radosgw host including a port number.</p>
</li>
<li>
<p><code>$SECS</code> is the number of seconds to run the benchmark. The default is
  60, but in order to get a quick idea of your radosgw performance, as
  little as 10 is often sufficient.</p>
</li>
<li>
<p><code>$BUCKET</code> is the scratch bucket where you’re creating objects during
  the benchmark run.</p>
</li>
<li>
<p><code>$ACCESS_KEY</code> and <code>$SECRET</code> are the access and secret keys you created
  with <code>radosgw-admin user create</code>.</p>
</li>
<li>
<p><code>write</code> specifies a random write benchmark.</p>
</li>
<li>
<p><code>--no-cleanup</code> specifies that you don’t want the bucket to be
    cleaned out after the benchmark run. It’s normally fine to run
    several benchmarks in a row and only empty the benchmark bucket
    when done with all.</p>
</li>
</ul>
<h2>Object size</h2>
<p>First, we’ll examine how object size affects radosgw throughput and
latency.</p>
<p>So let’s start out with a benchmark run that uses the default settings
for concurrency and object sizes:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">RGW</span><span class="o">=</span>localhost:7480
<span class="nb">export</span><span class="w"> </span><span class="nv">SECS</span><span class="o">=</span><span class="m">10</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SIZE</span><span class="o">=</span><span class="k">$((</span><span class="m">1</span><span class="o">&lt;&lt;</span><span class="m">22</span><span class="k">))</span><span class="w"> </span><span class="c1"># 4MB object size</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">BUCKET</span><span class="o">=</span>bench
<span class="nb">export</span><span class="w"> </span><span class="nv">CONCURRENCY</span><span class="o">=</span><span class="m">16</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">KEY</span><span class="o">=</span>your_radosgw_key
<span class="nb">export</span><span class="w"> </span><span class="nv">SECRET</span><span class="o">=</span>your_radosgw_secret

rest-bench<span class="w"> </span>-t<span class="w"> </span><span class="nv">$CONCURRENCY</span><span class="w"> </span>-b<span class="w"> </span><span class="nv">$SIZE</span><span class="w"> </span>--seconds<span class="o">=</span><span class="nv">$SECS</span><span class="w"> </span>--api-host<span class="o">=</span><span class="nv">$RGW</span><span class="w"> </span><span class="se">\</span>
--bucket<span class="o">=</span><span class="nv">$BUCKET</span><span class="w"> </span>--access-key<span class="o">=</span><span class="nv">$KEY</span><span class="w"> </span>--secret<span class="o">=</span><span class="nv">$SECRET</span><span class="w"> </span>--no-cleanup<span class="w"> </span>write
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">host</span><span class="o">=</span><span class="nv">localhost</span>:<span class="mi">7480</span>
<span class="nv">Maintaining</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="nv">concurrent</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">4194304</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">objects</span>
[...]
<span class="nv">Total</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">run</span>:<span class="w">         </span><span class="mi">10</span>.<span class="mi">312134</span>
<span class="nv">Total</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">made</span>:<span class="w">      </span><span class="mi">399</span>
<span class="nv">Write</span><span class="w"> </span><span class="nv">size</span>:<span class="w">             </span><span class="mi">4194304</span>
<span class="nv">Bandwidth</span><span class="w"> </span><span class="ss">(</span><span class="nv">MB</span><span class="o">/</span><span class="nv">sec</span><span class="ss">)</span>:<span class="w">     </span><span class="mi">154</span>.<span class="mi">769</span><span class="w"> </span>
[...]
</code></pre></div>
<p>So that means we achieved a bandwidth of just under 155 MB/s (which is
near the max RADOS bandwidth this particular cluster is capable of;
it’s by no means a high-end system) and we managed 399 writes, or
approx. 40 PUTs/s.</p>
<p>Let’s see how going even bigger changes things:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">SIZE</span><span class="o">=</span><span class="k">$((</span><span class="m">1</span><span class="o">&lt;&lt;</span><span class="m">26</span><span class="k">))</span><span class="w"> </span><span class="c1"># 64MB object size</span>

$<span class="w"> </span>rest-bench<span class="w"> </span>-t<span class="w"> </span><span class="nv">$CONCURRENCY</span><span class="w"> </span>-b<span class="w"> </span><span class="nv">$SIZE</span><span class="w"> </span>--seconds<span class="o">=</span><span class="nv">$SECS</span><span class="w"> </span>--api-host<span class="o">=</span><span class="nv">$RGW</span><span class="w"> </span><span class="se">\</span>
--bucket<span class="o">=</span><span class="nv">$BUCKET</span><span class="w"> </span>--access-key<span class="o">=</span><span class="nv">$KEY</span><span class="w"> </span>--secret<span class="o">=</span><span class="nv">$SECRET</span><span class="w"> </span>--no-cleanup<span class="w"> </span>write
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">host</span><span class="o">=</span><span class="nv">localhost</span>:<span class="mi">7480</span>
<span class="w"> </span><span class="nv">Maintaining</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="nv">concurrent</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">67108864</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">objects</span>
[...]
<span class="w"> </span><span class="nv">Total</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">run</span>:<span class="w">         </span><span class="mi">13</span>.<span class="mi">959088</span>
<span class="nv">Total</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">made</span>:<span class="w">      </span><span class="mi">35</span>
<span class="nv">Write</span><span class="w"> </span><span class="nv">size</span>:<span class="w">             </span><span class="mi">67108864</span>
<span class="nv">Bandwidth</span><span class="w"> </span><span class="ss">(</span><span class="nv">MB</span><span class="o">/</span><span class="nv">sec</span><span class="ss">)</span>:<span class="w">     </span><span class="mi">160</span>.<span class="mi">469</span>
</code></pre></div>
<p>Perfectly logical. Our bandwidth doesn’t change much, but of course
the number of PUTs we get done per second decreases significantly, to
a puny 3 PUTs/s. (Note: radosgw does break down objects into smaller
chunks when it talks to RADOS. However, this doesn’t change the fact
that a client needs to haul a 64MB object across the network and
through the radosgw HTTP server.)</p>
<p>Let’s do the opposite now, and go for smaller objects. Suppose your
application is using a typical object size of 32K.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SIZE</span><span class="o">=</span><span class="k">$((</span><span class="m">1</span><span class="o">&lt;&lt;</span><span class="m">15</span><span class="k">))</span><span class="w"> </span><span class="c1"># 32KB object size</span>
rest-bench<span class="w"> </span>-t<span class="w"> </span><span class="nv">$CONCURRENCY</span><span class="w"> </span>-b<span class="w"> </span><span class="nv">$SIZE</span><span class="w"> </span>--seconds<span class="o">=</span><span class="nv">$SECS</span><span class="w"> </span>--api-host<span class="o">=</span><span class="nv">$RGW</span><span class="w"> </span><span class="se">\</span>
--bucket<span class="o">=</span><span class="nv">$BUCKET</span><span class="w"> </span>--access-key<span class="o">=</span><span class="nv">$KEY</span><span class="w"> </span>--secret<span class="o">=</span><span class="nv">$SECRET</span><span class="w"> </span>--no-cleanup<span class="w"> </span>write
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">host</span><span class="o">=</span><span class="nv">localhost</span>:<span class="mi">7480</span>
<span class="w"> </span><span class="nv">Maintaining</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="nv">concurrent</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">32768</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">objects</span>
[...]
<span class="w"> </span><span class="nv">Total</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">run</span>:<span class="w">         </span><span class="mi">10</span>.<span class="mi">042325</span>
<span class="nv">Total</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">made</span>:<span class="w">      </span><span class="mi">2965</span>
<span class="nv">Write</span><span class="w"> </span><span class="nv">size</span>:<span class="w">             </span><span class="mi">32768</span>
<span class="nv">Bandwidth</span><span class="w"> </span><span class="ss">(</span><span class="nv">MB</span><span class="o">/</span><span class="nv">sec</span><span class="ss">)</span>:<span class="w">     </span><span class="mi">9</span>.<span class="mi">227</span>
[...]
</code></pre></div>
<p>Of course if we looked at our bandwidth alone, this would be an
abysmal result. But your application is trying to write 32K chunks,
and lots of them. And it’s succeeding just fine; we’re now near 300
PUTs/s.</p>
<p>Going even smaller, we’d expect PUTs/s to trend further up and nominal
MB/s to go down. Let’s try with 4K objects:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SIZE</span><span class="o">=</span><span class="k">$((</span><span class="m">1</span><span class="o">&lt;&lt;</span><span class="m">12</span><span class="k">))</span><span class="w"> </span><span class="c1"># 4KB object size</span>
rest-bench<span class="w"> </span>-t<span class="w"> </span><span class="nv">$CONCURRENCY</span><span class="w"> </span>-b<span class="w"> </span><span class="nv">$SIZE</span><span class="w"> </span>--seconds<span class="o">=</span><span class="nv">$SECS</span><span class="w"> </span>--api-host<span class="o">=</span><span class="nv">$RGW</span><span class="w"> </span><span class="se">\</span>
--bucket<span class="o">=</span><span class="nv">$BUCKET</span><span class="w"> </span>--access-key<span class="o">=</span><span class="nv">$KEY</span><span class="w"> </span>--secret<span class="o">=</span><span class="nv">$SECRET</span><span class="w"> </span>--no-cleanup<span class="w"> </span>write
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">host</span><span class="o">=</span><span class="nv">localhost</span>:<span class="mi">7480</span>
<span class="w"> </span><span class="nv">Maintaining</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="nv">concurrent</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">objects</span>
[...]
<span class="nv">Total</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">run</span>:<span class="w">         </span><span class="mi">10</span>.<span class="mi">052134</span>
<span class="nv">Total</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">made</span>:<span class="w">      </span><span class="mi">3249</span>
<span class="nv">Write</span><span class="w"> </span><span class="nv">size</span>:<span class="w">             </span><span class="mi">4096</span>
<span class="nv">Bandwidth</span><span class="w"> </span><span class="ss">(</span><span class="nv">MB</span><span class="o">/</span><span class="nv">sec</span><span class="ss">)</span>:<span class="w">     </span><span class="mi">1</span>.<span class="mi">263</span><span class="w"> </span>
[...]
</code></pre></div>
<p>And sure enough, 325 PUTs/s.</p>
<p>So in summary, larger object sizes increase your write bandwidth to
your radosgw cluster, while smaller objects enable a higher
writes-per-second load.</p>
<h2>Concurrency</h2>
<p>Another aspect that influences your radosgw performance is
concurrency. Generally, the principle is simple: if you have multiple
parallel applications that write to radosgw and that don’t have to
wait for each other, your aggregate throughput will be higher, and
your writes-per-second will be higher as well. If you have a small
number (in the worst case, a single one that is single-threaded) and
you can only ever issue one PUT at a time, both throughput and
writes-per-second will be lower in aggregate.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">RGW</span><span class="o">=</span>localhost:7480
<span class="nb">export</span><span class="w"> </span><span class="nv">SECS</span><span class="o">=</span><span class="m">10</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SIZE</span><span class="o">=</span><span class="k">$((</span><span class="m">1</span><span class="o">&lt;&lt;</span><span class="m">22</span><span class="k">))</span><span class="w"> </span><span class="c1"># back to 4MB object size</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">BUCKET</span><span class="o">=</span>bench
<span class="nb">export</span><span class="w"> </span><span class="nv">CONCURRENCY</span><span class="o">=</span><span class="m">16</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">KEY</span><span class="o">=</span>&lt;key&gt;
<span class="nb">export</span><span class="w"> </span><span class="nv">SECRET</span><span class="o">=</span>&lt;secret&gt;

$<span class="w"> </span>rest-bench<span class="w"> </span>-t<span class="w"> </span><span class="nv">$CONCURRENCY</span><span class="w"> </span>-b<span class="w"> </span><span class="nv">$SIZE</span><span class="w"> </span>--seconds<span class="o">=</span><span class="nv">$SECS</span><span class="w"> </span>--api-host<span class="o">=</span><span class="nv">$RGW</span><span class="w"> </span><span class="se">\</span>
--bucket<span class="o">=</span><span class="nv">$BUCKET</span><span class="w"> </span>--access-key<span class="o">=</span><span class="nv">$KEY</span><span class="w"> </span>--secret<span class="o">=</span><span class="nv">$SECRET</span><span class="w"> </span>--no-cleanup<span class="w"> </span>write
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">host</span><span class="o">=</span><span class="nv">localhost</span>:<span class="mi">7480</span>
<span class="w"> </span><span class="nv">Maintaining</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="nv">concurrent</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">4194304</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">objects</span>
[...]
<span class="nv">Total</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">run</span>:<span class="w">         </span><span class="mi">10</span>.<span class="mi">294444</span>
<span class="nv">Total</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">made</span>:<span class="w">      </span><span class="mi">394</span>
<span class="nv">Write</span><span class="w"> </span><span class="nv">size</span>:<span class="w">             </span><span class="mi">4194304</span>
<span class="nv">Bandwidth</span><span class="w"> </span><span class="ss">(</span><span class="nv">MB</span><span class="o">/</span><span class="nv">sec</span><span class="ss">)</span>:<span class="w">     </span><span class="mi">153</span>.<span class="mi">092</span><span class="w"> </span>
[...]
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">CONCURRENCY</span><span class="o">=</span><span class="m">1</span>
rest-bench<span class="w"> </span>-t<span class="w"> </span><span class="nv">$CONCURRENCY</span><span class="w"> </span>-b<span class="w"> </span><span class="nv">$SIZE</span><span class="w"> </span>--seconds<span class="o">=</span><span class="nv">$SECS</span><span class="w"> </span>--api-host<span class="o">=</span><span class="nv">$RGW</span><span class="w"> </span><span class="se">\</span>
--bucket<span class="o">=</span><span class="nv">$BUCKET</span><span class="w"> </span>--access-key<span class="o">=</span><span class="nv">$KEY</span><span class="w"> </span>--secret<span class="o">=</span><span class="nv">$SECRET</span><span class="w"> </span>--no-cleanup<span class="w"> </span>write
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">host</span><span class="o">=</span><span class="nv">localhost</span>:<span class="mi">7480</span>
<span class="w"> </span><span class="nv">Maintaining</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">concurrent</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">4194304</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">objects</span>
[...]
<span class="w"> </span><span class="nv">Total</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">run</span>:<span class="w">         </span><span class="mi">10</span>.<span class="mi">090768</span>
<span class="nv">Total</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">made</span>:<span class="w">      </span><span class="mi">147</span>
<span class="nv">Write</span><span class="w"> </span><span class="nv">size</span>:<span class="w">             </span><span class="mi">4194304</span>
<span class="nv">Bandwidth</span><span class="w"> </span><span class="ss">(</span><span class="nv">MB</span><span class="o">/</span><span class="nv">sec</span><span class="ss">)</span>:<span class="w">     </span><span class="mi">58</span>.<span class="mi">271</span>
</code></pre></div>
<p>Logical, right? Rather than allowing 16 threads to interact with the
cluster in parallel, we now have to wait for every single PUT to
complete before we can issue the next. Pretty obvious to see both our
writes-per-second and our aggregate bandwidth to drop by more than
half.</p>
<p>The effect is even slightly less pronounced with smaller
objects. Compare the two for 4KB objects:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SIZE</span><span class="o">=</span><span class="k">$((</span><span class="m">1</span><span class="o">&lt;&lt;</span><span class="m">12</span><span class="k">))</span><span class="w"> </span><span class="c1"># 4KB object size</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CONCURRENCY</span><span class="o">=</span><span class="m">16</span>
rest-bench<span class="w"> </span>-t<span class="w"> </span><span class="nv">$CONCURRENCY</span><span class="w"> </span>-b<span class="w"> </span><span class="nv">$SIZE</span><span class="w"> </span>--seconds<span class="o">=</span><span class="nv">$SECS</span><span class="w"> </span>--api-host<span class="o">=</span><span class="nv">$RGW</span><span class="w"> </span><span class="se">\</span>
--bucket<span class="o">=</span><span class="nv">$BUCKET</span><span class="w"> </span>--access-key<span class="o">=</span><span class="nv">$KEY</span><span class="w"> </span>--secret<span class="o">=</span><span class="nv">$SECRET</span><span class="w"> </span>--no-cleanup<span class="w"> </span>write
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">host</span><span class="o">=</span><span class="nv">localhost</span>:<span class="mi">7480</span>
<span class="w"> </span><span class="nv">Maintaining</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="nv">concurrent</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">objects</span>
[...]
<span class="w"> </span><span class="nv">Total</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">run</span>:<span class="w">         </span><span class="mi">10</span>.<span class="mi">053976</span>
<span class="nv">Total</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">made</span>:<span class="w">      </span><span class="mi">3211</span>
<span class="nv">Write</span><span class="w"> </span><span class="nv">size</span>:<span class="w">             </span><span class="mi">4096</span>
<span class="nv">Bandwidth</span><span class="w"> </span><span class="ss">(</span><span class="nv">MB</span><span class="o">/</span><span class="nv">sec</span><span class="ss">)</span>:<span class="w">     </span><span class="mi">1</span>.<span class="mi">248</span><span class="w"> </span>
[...]
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">CONCURRENCY</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>
rest-bench<span class="w"> </span>-t<span class="w"> </span><span class="nv">$CONCURRENCY</span><span class="w"> </span>-b<span class="w"> </span><span class="nv">$SIZE</span><span class="w"> </span>--seconds<span class="o">=</span><span class="nv">$SECS</span><span class="w"> </span>--api-host<span class="o">=</span><span class="nv">$RGW</span><span class="w"> </span><span class="se">\</span>
--bucket<span class="o">=</span><span class="nv">$BUCKET</span><span class="w"> </span>--access-key<span class="o">=</span><span class="nv">$KEY</span><span class="w"> </span>--secret<span class="o">=</span><span class="nv">$SECRET</span><span class="w"> </span>--no-cleanup<span class="w"> </span>write
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">host</span><span class="o">=</span><span class="nv">localhost</span>:<span class="mi">7480</span>
<span class="w"> </span><span class="nv">Maintaining</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">concurrent</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="nv">bytes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">objects</span>
[...]
<span class="w"> </span><span class="nv">Total</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">run</span>:<span class="w">         </span><span class="mi">10</span>.<span class="mi">007962</span>
<span class="nv">Total</span><span class="w"> </span><span class="nv">writes</span><span class="w"> </span><span class="nv">made</span>:<span class="w">      </span><span class="mi">1632</span>
<span class="nv">Write</span><span class="w"> </span><span class="nv">size</span>:<span class="w">             </span><span class="mi">4096</span>
<span class="nv">Bandwidth</span><span class="w"> </span><span class="ss">(</span><span class="nv">MB</span><span class="o">/</span><span class="nv">sec</span><span class="ss">)</span>:<span class="w">     </span><span class="mi">0</span>.<span class="mi">637</span>
[...]
</code></pre></div>
<p>Both writes-per-second and throughput drop by half.</p>
<h2>Conclusions</h2>
<p>Note: If you’ve dealt with storage performance considerations before,
some of these will be blindingly obvious. Apologies for that; it just
shows that Ceph is generally a well-behaved system that does what you
would normally expect.</p>
<ul>
<li>
<p>Larger objects have less overhead, and as such increase your
  throughput,</p>
</li>
<li>
<p>Smaller objects increase writes-per-second at the expense of
  aggregate throughput, because they have more overhead,</p>
</li>
<li>
<p>Serialization and contention (both of which mean reduced
  concurrency) reduce your data throughput and your writes-per-second.</p>
</li>
</ul>
<p>What does this mean for your radosgw application?</p>
<ul>
<li>
<p>Concurrency is good. If your application can fire a bunch of RESTful
  objects at radosgw, which don’t have to wait for each other, great.</p>
</li>
<li>
<p>If you need to optimize for lots of PUTs per second, make sure that
  your application sends data in reasonably sized chunks. And again,
  make sure it is capable of doing so in parallel.</p>
</li>
</ul>
<p>If you need to optimize for throughput instead, make sure that your application coalesces data into large objects. There is a big difference between sending one object of 10MB, and 10 objects of 1 MB.</p>
<hr/>
<p>This article originally appeared on the <code>hastexo.com</code> website (now defunct).</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../../tag/ceph.html">Ceph</a>
    </p>
  </div>






</article>

<footer>
<p>
  &copy; 2023  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike License</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " xahteiwi.eu ",
  "url" : "../../..",
  "image": "https://xahteiwi.eu/images/avatar.jpg",
  "description": ""
}
</script>
</body>
</html>