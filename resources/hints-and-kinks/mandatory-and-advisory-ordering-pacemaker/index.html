
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index,follow" />


    <link rel="stylesheet" type="text/css" href="../../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../../theme/pygments/github.min.css">

    <link rel="stylesheet" 
    href="../../../theme/tipuesearch/tipuesearch.min.css" />


  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/css/override.css">



  <link href="https://xahteiwi.eu/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="xahteiwi.eu Atom">

  <link href="https://xahteiwi.eu/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="xahteiwi.eu RSS">


<script defer data-domain="xahteiwi.eu" src="https://plausible.io/js/plausible.js"></script>

 

<meta name="author" content="Florian Haas" />
<meta name="description" content="Ever wonder what’s the difference between order &lt;name&gt; inf: &lt;first-resource&gt; &lt;second-resource&gt; and a score of something other than inf? We’ll explain. If you specify an order constraint score of INFINITY (inf or the keyword mandatory in crm shell syntax), then the order constraint is considered mandatory. If you …" />
<meta name="keywords" content="Pacemaker">


  <meta property="og:site_name" content="xahteiwi.eu"/>
  <meta property="og:title" content="Mandatory and advisory ordering in Pacemaker"/>
  <meta property="og:description" content="Ever wonder what’s the difference between order &lt;name&gt; inf: &lt;first-resource&gt; &lt;second-resource&gt; and a score of something other than inf? We’ll explain. If you specify an order constraint score of INFINITY (inf or the keyword mandatory in crm shell syntax), then the order constraint is considered mandatory. If you …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../../resources/hints-and-kinks/mandatory-and-advisory-ordering-pacemaker/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2012-03-22 15:02:14+01:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../../author/florian-haas.html">
  <meta property="article:section" content="hints-and-kinks"/>
  <meta property="article:tag" content="Pacemaker"/>
  <meta property="og:image" content="https://xahteiwi.eu/images/avatar.jpg">

  <title>xahteiwi.eu &ndash; Mandatory and advisory ordering in Pacemaker</title>


</head>
<body >

<aside>
  <div>
    <a href="../../../">
      <img src="https://xahteiwi.eu/images/avatar.jpg" alt="" title="">
    </a>

    <h1>
      <a href="../../../"></a>
    </h1>


    <form class="navbar-search" action="../../../search.html" role="search">
      <input type="text" name="q" id="tipue_search_input" placeholder="Search...">
    </form>


    <ul class="social">
      <li>
        <a class="sc-twitter"
           href="https://twitter.com/xahteiwi"
           target="_blank">
          <i class="fa-brands fa-twitter"></i>
        </a>
      </li>
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://mastodon.social/@xahteiwi"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/fghaas"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/fghaas"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="../../../">Home</a>

  <a href="/category/hints-and-kinks.html">Tech</a>
  <a href="/category/presentations.html">Talks</a>
  <a href="/category/blog.html">Thoughts</a>
  <a href="">​</a>
  <a href="/about/">About</a>
  <a href="/comments/">Comments</a>
  <a href="/legal/">Legal</a>
  <a href="/privacy/">Privacy</a>
  <a href="">​</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>
  <a href="">​</a>

  <a href="https://xahteiwi.eu/feeds/all.atom.xml">Atom</a>

  <a href="https://xahteiwi.eu/feeds/all.rss.xml">RSS</a>
</nav>

<article class="single">
  <header>
      
    <h1 id="mandatory-and-advisory-ordering-pacemaker">Mandatory and advisory ordering in Pacemaker</h1>
    <p>
      Posted on Thu 22 March 2012 in <a href="../../../category/hints-and-kinks.html">hints-and-kinks</a>

        &#8226; 2 min read
    </p>
  </header>


  <div>
    <p>Ever wonder what’s the difference between <code>order &lt;name&gt; inf:
&lt;first-resource&gt; &lt;second-resource&gt;</code> and a score of something other
than <code>inf</code>? We’ll explain.</p>
<p>If you specify an order constraint score of <code>INFINITY</code> (<code>inf</code> or the
keyword <code>mandatory</code> in crm shell syntax), then the order constraint is
considered mandatory. If you specify <code>0</code>, or the keyword <code>advisory</code>
then it’s advisory. What does that mean?</p>
<p>Firstly, anytime two resources are started in the same cluster
transition, order constraints do apply regardless of whether they’re
mandatory or advisory. So for the two constraints shown here:</p>
<div class="highlight"><pre><span></span><code>order o_foo_before_bar inf: foo bar
order o_foo_before_bar 0: foo bar
</code></pre></div>
<p>… if <code>foo</code> and <code>bar</code> are just starting, <code>foo</code> starts first, and
<code>bar</code> starts only when <code>foo</code>‘s start operation is completed. So what’s
the difference, really?</p>
<h2>Mandatory ordering</h2>
<p>In a <strong>mandatory</strong> order constraint, the order is enforced under all
circumstances. Consider the following example (primitive definitions
omitted to keep this short):</p>
<div class="highlight"><pre><span></span><code>order o_foo_before_bar inf: foo bar
</code></pre></div>
<p>Suppose <code>foo</code> fails. Now <code>foo</code> must be recovered, but before that,
<code>bar</code> must also stop. So the sequence of events is:</p>
<ol>
<li><code>foo</code> fails</li>
<li>Pacemaker attempts to stop <code>foo</code> again (to make sure it’s cleaned
   up).</li>
<li><code>bar</code> stops.</li>
<li><code>foo</code> starts</li>
<li><code>bar</code> starts.</li>
</ol>
<p>If <code>foo</code> fails to start back up, then <code>bar</code> will remain stopped. Based
on the start-failure-is-fatal and migration-threshold settings both
resources can now potentially migrate to other nodes, but if <code>foo</code>
can’t be started anywhere, <code>bar</code> also remains stopped.</p>
<h2>Advisory ordering</h2>
<p>In an <strong>advisory</strong> order constraint, the order is enforced only if
both resources start in the same transition. Otherwise, it’s
ignored. Consider the following example (primitive definitions again
omitted):</p>
<div class="highlight"><pre><span></span><code>order o_foo_before_bar 0: foo bar
</code></pre></div>
<p>Again, suppose <code>foo</code> fails. <code>foo</code> must be recovered, but now <code>bar</code> can
keep running as it’s not being started in the same transition. Thus:</p>
<ol>
<li><code>foo</code> fails</li>
<li>Pacemaker attempts to stop <code>foo</code> again (to make sure it’s cleaned
   up).</li>
<li><code>foo</code> starts</li>
</ol>
<p>If <code>foo</code> fails to start back up, then <code>bar</code> can continue to
run. Still, based on the <code>start-failure-is-fatal</code> and
<code>migration-threshold</code> settings applying to <code>foo</code>, either it or both
resources (depending on colocation constraints) can potentially
migrate to other nodes.</p>
<h2>So when do I use which?</h2>
<p>Advisory ordering is good for when your dependent resource can recover
from a brief interruption in the resource it depends on. For example,
you’ll want to fire up your libvirt daemon before you start your
Pacemaker-managed virtual machines, but if libvirtd were ever to crash
you can restart it without needing to restart VMs.</p>
<p>Mandatory ordering is for stricter dependencies. Filesystems mounted
from an iSCSI device will probably want to be remounted if the iSCSI
initator has reported an error. Likewise, you’ll probably also want to
restart the applications working with that filesystem.</p>
<hr/>
<p>This article originally appeared on the <code>hastexo.com</code> website (now defunct).</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../../tag/pacemaker.html">Pacemaker</a>
    </p>
  </div>






</article>

<footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike License</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " xahteiwi.eu ",
  "url" : "../../..",
  "image": "https://xahteiwi.eu/images/avatar.jpg",
  "description": ""
}
</script>
</body>
</html>