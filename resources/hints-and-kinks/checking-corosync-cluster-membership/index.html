
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index,follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="../../../theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="../../../theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="../../../theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="../../../theme/pygments/github.min.css">


  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="../../../theme/font-awesome/css/solid.css">

    <link rel="stylesheet" type="text/css" href="../../../css/override.css">

    <link href="https://xahteiwi.eu/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="xahteiwi.eu Atom">

    <link href="https://xahteiwi.eu/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="xahteiwi.eu RSS">


  


 

<meta name="author" content="Florian Haas" />
<meta name="description" content="It&#39;s simple and easy to get Pacemaker&#39;s view of the status of members in a cluster – just invoke crm_mon. But what if you want to check on the cluster membership when Pacemaker is not running, or you want to make sure whether Corosync&#39;s view of the cluster is identical to …" />
<meta name="keywords" content="Corosync">


  <meta property="og:site_name" content="xahteiwi.eu"/>
  <meta property="og:title" content="Checking Corosync cluster membership"/>
  <meta property="og:description" content="It&#39;s simple and easy to get Pacemaker&#39;s view of the status of members in a cluster – just invoke crm_mon. But what if you want to check on the cluster membership when Pacemaker is not running, or you want to make sure whether Corosync&#39;s view of the cluster is identical to …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="../../../resources/hints-and-kinks/checking-corosync-cluster-membership/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2012-03-04 23:42:35+01:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="../../../author/florian-haas.html">
  <meta property="article:section" content="hints-and-kinks"/>
  <meta property="article:tag" content="Corosync"/>
  <meta property="og:image" content="https://xahteiwi.eu/images/avatar.jpg">

  <title>xahteiwi.eu &ndash; Checking Corosync cluster membership</title>

</head>
<body >
  <aside>
    <div>
      <a href="../../../">
        <img src="https://xahteiwi.eu/images/avatar.jpg" alt="" title="">
      </a>

      <h1>
        <a href="../../../"></a>
      </h1>




      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/xahteiwi" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a rel="me" class="sc-mastodon" href="https://mastodon.social/@xahteiwi" target="_blank">
              <i class="fab fa-mastodon"></i>
            </a>
          </li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/fghaas" target="_blank">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
          <li>
            <a  class="sc-github" href="https://github.com/fghaas" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="../../../">Home</a>

      <a href="/category/hints-and-kinks.html">Tech</a>
      <a href="/category/presentations.html">Talks</a>
      <a href="/category/blog.html">Thoughts</a>
      <a href="">​</a>
      <a href="/about/">About</a>
      <a href="/comments/">Comments</a>
      <a href="/legal/">Legal</a>
      <a href="/privacy/">Privacy</a>
      <a href="">​</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
      <a href="">​</a>

      <a href="https://xahteiwi.eu/feeds/all.atom.xml">Atom</a>

      <a href="https://xahteiwi.eu/feeds/all.rss.xml">RSS</a>
    </nav>

<article class="single">
  <header>
      
    <h1 id="checking-corosync-cluster-membership">Checking Corosync cluster membership</h1>
    <p>
      Posted on Sun 04 March 2012 in <a href="../../../category/hints-and-kinks.html">hints-and-kinks</a>

    </p>
  </header>


  <div>
    <p>It's simple and easy to get Pacemaker's view of the status of members
in a cluster – just invoke <code>crm_mon</code>. But what if you want to check on
the cluster membership when Pacemaker is not running, or you want to
make sure whether Corosync's view of the cluster is identical to
Pacemaker's? Here's how.</p>
<h2>Checking ring status with <code>corosync-cfgtool</code></h2>
<p>The <code>corosync-cfgtool</code> utility displays the cluster connectivity status
when invoked with the <code>-s</code> flag:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># corosync-cfgtool -s</span><span class="w"></span>
<span class="n">Printing</span><span class="w"> </span><span class="n">ring</span><span class="w"> </span><span class="n">status</span><span class="o">.</span><span class="w"></span>
<span class="n">Local</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">303938909</span><span class="w"></span>
<span class="n">RING</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="o">.</span><span class="mf">1.1</span><span class="w"></span>
<span class="w">    </span><span class="n">status</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ring</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">faults</span><span class="w"></span>
<span class="n">RING</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="n">id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">42.1</span><span class="w"></span>
<span class="w">    </span><span class="n">status</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ring</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">faults</span><span class="w"></span>
</code></pre></div>
<p>The above is the status of two healthy rings; a failed ring (one
affected by a network interruption, for example) would show a <code>FAULTY</code>
status.</p>
<p>There's a catch. In a two-node cluster, if both nodes were to start
while all cluster communication links are down, then Corosync would
form <em>two</em> memberships with healthy, one-member rings. Both of the
nodes would show a ring status similar to the above, but your cluster
still wouldn't be communicating. So, you can't rely on
<code>corosync-cfgtool -s</code> alone. You must also check Corosync's member
list.</p>
<h2>Querying the member list with <code>corosync-cmapctl</code></h2>
<p>We can examine Corosync's cluster member list with the <code>corosync-cmapctl</code> command:</p>
<div class="highlight"><pre><span></span><code># corosync-cmapctl | grep member
runtime.totem.pg.mrp.srp.members.303938909.ip=r(0) ip(10.0.1.1) r(1) ip(192.168.42.1) 
runtime.totem.pg.mrp.srp.members.303938909.join_count=1
runtime.totem.pg.mrp.srp.members.303938909.status=joined
runtime.totem.pg.mrp.srp.members.320716125.ip=r(0) ip(10.0.1.2) r(1) ip(192.168.42.2) 
runtime.totem.pg.mrp.srp.members.320716125.join_count=1
runtime.totem.pg.mrp.srp.members.320716125.status=joined
</code></pre></div>
<p>In this example, we have two nodes (with node IDs <code>303938909</code> and
<code>320716125</code>). They are both configured to use two communication rings,
<code>r(0)</code> and <code>r(1)</code>, and both of them have successfully joined the
cluster.</p>
<p><strong>Note:</strong> In earlier Corosync releases (pre-2.0), the
<code>corosync-cmapctl</code> tool was called <code>corosync-objctl</code>. Its command
syntax for querying the member list was identical.</p>
<hr/>
<p>This article originally appeared on the <code>hastexo.com</code> website (now defunct).</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="../../../tag/corosync.html">Corosync</a>
    </p>
  </div>






</article>

    <footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike License</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="../../../theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " xahteiwi.eu ",
  "url" : "../../..",
  "image": "https://xahteiwi.eu/images/avatar.jpg",
  "description": ""
}
</script>

</body>
</html>